import asyncio
import os
from dotenv import load_dotenv
from aiogram import Bot, Dispatcher
from db import init_db

# –ó–∞–≥—Ä—É–∂–∞–µ–º .env –¥–æ –∏–º–ø–æ—Ä—Ç–æ–≤ —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤
load_dotenv()

# –ü—Ä–æ–≤–µ—Ä–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
for var in ("BOT_TOKEN", "ADMIN_IDS", "DB_PATH"):
    if not os.getenv(var):
        raise RuntimeError(f"{var} –Ω–µ –∑–∞–¥–∞–Ω –≤ .env")

from handlers import admin, user  # –∏–º–ø–æ—Ä—Ç –ø–æ—Å–ª–µ load_dotenv

async def main():
    await init_db()

    bot = Bot(token=os.getenv("BOT_TOKEN"))
    dp = Dispatcher()

    dp.include_router(admin.router)
    dp.include_router(user.router)

    print("üöÄ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω. –ù–∞–∂–º–∏ Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏.")
    try:
        await dp.start_polling(bot)
    except (KeyboardInterrupt, SystemExit):
        print("üõë –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.")

if __name__ == "__main__":
    asyncio.run(main())
